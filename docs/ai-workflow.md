# wheel-ai AI 工作流程指南

> 将本文件作为每轮提示的前置上下文，帮助 AI 自主完成从需求到 PR 的闭环。所有输出请保持中文，能落地的步骤直接执行，不要重复询问。

## 总体原则
- 充分利用持久化文件：`plan` 维护可执行计划，`notes` 记录每轮结论/风险/遗留问题。每轮必须更新 notes，必要时重写 plan 使其保持最新。
- 开发分支统一在 git worktree 中进行，遵循“基线分支 → 派生分支 → 迭代 → PR”的流程。
- 与 git/PR 相关的操作仅使用 `gh` 命令（查看 PR、创建 PR、查看 Actions 失败记录）。
- 默认测试命令：单元测试 `yarn test`，e2e 测试 `yarn e2e`，如需调整请在 plan 中显式写出新的命令。

## 步骤 1：完善需求
- 复述并澄清任务，标出输入、输出、约束、验收标准。
- 列出不确定点并自行做出合理假设（在 notes 记录假设）。
- 产出：需求摘要（要写入 notes）。

## 步骤 2：生成计划
- 形成分阶段的任务树：需求澄清 → 设计 → 开发 → 自审 → 测试 → PR。
- 为每个阶段列出可执行子任务、负责人（默认 AI）、预计产出、检查点。
- 将计划写入 `plan` 文件，保持随迭代更新，已完成项用 ✅ 标记。

## 步骤 3：设计与开发
- 先给出技术方案：文件/模块变更列表、数据结构、关键算法、外部依赖、潜在风险。
- 直接生成或修改代码；若需脚手架/依赖，请写出命令并在可行时直接执行。
- 代码须符合 TypeScript 严格类型（避免 any），遵循项目现有规范。

## 步骤 4：代码自审
- 自检清单：
  - 需求覆盖与边界条件是否完整。
  - 类型安全、错误处理、日志可读性。
  - 与 git worktree 兼容性、命令幂等性。
- 产出：风险与改进列表，写入 notes。

## 步骤 5：生成与执行测试
- 至少输出：
  - 单元测试范围与用例表。
  - e2e 场景与前置条件。
  - 对应的命令行（可直接运行）。
- 在环境允许时直接执行测试命令，收集结果与失败原因写入 notes。

## 步骤 6：推送并提交 PR
- 检查 git 状态，准备提交信息（建议格式：`chore: <任务概要>`）。
- 使用 `gh pr create --head <branch> --title "<标题>" --body-file <path>`（或 `--body "<正文>"`）创建 PR，正文应包含：
  - 变更摘要（bullet 列表）
  - 测试结果（含失败原因）
  - 风险与回滚方案
- 若已有 PR，使用 `gh pr view <branch>` 获取链接；查看 Actions 失败可运行 `gh run list --branch <branch>`。

## 步骤 7：持久化记忆与对话续航
- 每轮结束必须向 notes 追加：
  - 关键决策与理由
  - 代码/测试进展
  - 阻塞与下一步计划
- 当阶段性任务完成或需要清理上下文时，开启新对话并把 plan 与 notes 作为前置信息继续。

## 输出规范
- 在所有目标完成时，输出中加入标记 `<<DONE>>`，外层循环据此停止。
- 优先输出可执行命令与文件路径，便于外层自动化调用。
- 日志/说明保持简洁，用中文短句，避免重复。
