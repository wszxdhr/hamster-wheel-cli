# wheel-ai AI 工作流程指南

> 将本文件作为每轮提示的前置上下文，帮助 AI 自主完成从需求到 PR 的闭环。所有输出请保持中文，能落地的步骤直接执行，不要重复询问。

## 总体原则
- 充分利用持久化文件：`plan` 维护可执行计划，`notes` 记录每轮结论/风险/遗留问题。每轮必须更新 notes。
- 计划仅包含开发相关任务，不包含测试、质量检查或 PR。
- 开发分支统一在 git worktree 中进行，遵循“基线分支 → 派生分支 → 迭代 → PR”的流程。
- 与 git/PR 相关的操作仅使用 `gh` 命令（查看 PR、创建 PR、查看 Actions 失败记录）。
- 默认测试命令：单元测试 `yarn test`，e2e 测试 `yarn e2e`，如需调整请在 plan 或命令行参数中显式写出新的命令。
- 代码质量检查阶段若 `AGENTS.md` 明确要求跳过，或命令行参数显式跳过，则不执行。

## 步骤 1：计划会话（新会话）
- 复述并澄清任务，标出输入、输出、约束、验收标准。
- 基于任务生成分支名（格式 `wheel-ai/<slug>`，全小写、短横线分隔）。
- 如果已有 `plan.md`，先评估合理性：合理则保持，不合理则输出新的完整计划。
- 计划只包含开发相关任务，不包含测试/质量检查/PR。

## 步骤 2：执行循环（每轮新会话）
- 每轮只执行 plan 中最后一条未完成任务。
- 执行完成后标记该计划项为 ✅，并更新 notes。
- 当 plan 全部完成时结束循环。

## 步骤 3：代码质量检查（新会话）
- 读取项目配置文件，选择并执行支持的代码质量检查工具（优先使用项目脚本）。
- 若出现报错，结束当前会话，开启新会话并附上报错信息进行修复。
- 修复完成后重新执行质量检查，循环直至通过。

## 步骤 4：生成与执行测试
- 给出单元测试与 e2e 场景或范围，输出可运行的命令行。
- 在环境允许时直接执行测试命令，收集结果与失败原因写入 notes。

## 步骤 5：推送并提交 PR
- 检查 git 状态，准备提交信息（建议格式：`chore: <任务概要>`）。
- 使用 `gh pr create --head <branch> --title "<标题>" --body-file <path>`（或 `--body "<正文>"`）创建 PR，正文应包含：
  - 变更摘要（bullet 列表）
  - 测试结果（含失败原因）
  - 风险与回滚方案
- 若已有 PR，使用 `gh pr view <branch>` 获取链接；查看 Actions 失败可运行 `gh run list --branch <branch>`。

## 步骤 6：持久化记忆与对话续航
- 每轮结束必须向 notes 追加：
  - 关键决策与理由
  - 代码/测试进展
  - 阻塞与下一步计划
- 当阶段性任务完成或需要清理上下文时，开启新对话并把 plan 与 notes 作为前置信息继续。

## 输出规范
- 在所有目标完成时，输出中加入标记 `<<DONE>>`，外层循环据此停止。
- 优先输出可执行命令与文件路径，便于外层自动化调用。
- 日志/说明保持简洁，用中文短句，避免重复。
